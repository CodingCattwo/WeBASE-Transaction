# 接口说明
## 1. 合约接口

### 1.1 合约部署接口 

#### 接口描述

调用此接口进行合约部署。

#### 接口URL

http://localhost:5003/WeBASE-Transaction/contract/deploy

#### 调用方法

HTTP POST

#### 请求参数

**1）参数表**

| **序号** | **中文**     | **参数名**  | **类型**       | **最大长度** | **必填** | **说明**                                           |
|----------|--------------|-------------|----------------|--------------|----------|----------------------------------------------------|
| 1        | 群组编号     | groupId     | int            | 16           | 是       |                                                    |
| 2        | 合约Bin      | bytecodeBin | String         |              | 是       |                                                    |
| 3        | 合约Abi      | contractAbi | List\<Object\> |              | 是       | JSON数组                                           |
| 4        | 构造方法参数 | funcParam   | List\<Object\> |              | 否       | JSON数组                                           |
| 5 | 签名用户编号 | signUserId | String | 64 | 是 | WeBASE-Sign用户 |

**2）数据格式**
```
{
  "bytecodeBin": "608060405234801561001057600080fd5b50610373806100206000396000f30060806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063299f7f9d146100515780633590b49f146100e1575b600080fd5b34801561005d57600080fd5b5061006661014a565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100a657808201518184015260208101905061008b565b50505050905090810190601f1680156100d35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156100ed57600080fd5b50610148600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506101ec565b005b606060008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101e25780601f106101b7576101008083540402835291602001916101e2565b820191906000526020600020905b8154815290600101906020018083116101c557829003601f168201915b5050505050905090565b7f05432a43e07f36a8b98100b9cb3631e02f8e796b0a06813610ce8942e972fb81816040518080602001828103825283818151815260200191508051906020019080838360005b8381101561024e578082015181840152602081019050610233565b50505050905090810190601f16801561027b5780820380516001836020036101000a031916815260200191505b509250505060405180910390a1806000908051906020019061029e9291906102a2565b5050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106102e357805160ff1916838001178555610311565b82800160010185558215610311579182015b828111156103105782518255916020019190600101906102f5565b5b50905061031e9190610322565b5090565b61034491905b80821115610340576000816000905550600101610328565b5090565b905600a165627a7a7230582077e2db38eecb729562ac614505b3507007a6acce30fd30971bd0501a019eb02d0029",
  "contractAbi": [{"constant":true,"inputs":[],"name":"get","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"n","type":"string"}],"name":"set","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"name","type":"string"}],"name":"SetName","type":"event"}],
  "funcParam": [
  ],
  "groupId": 1,
  "signUserId": "user1001"
}
```
#### 响应参数

**1）参数表**

| **序号** | **中文** | **参数名** | **类型** | **最大长度** | **必填** | **说明**          |
|----------|----------|------------|----------|--------------|----------|-------------------|
| 1        | 返回码   | code       | String   |              | 是       | 返回码信息请附录1 |
| 2        | 提示信息 | message    | String   |              | 是       |                   |
| 3        | 返回数据 | data       | Object   |              | 是       |           |

**2）数据格式**

a.请求正常返回结果

```
{
  "code": 0,
  "message": "success",
  "data": {
    "transactionHash": "0xccc4b445fd69fd35a28d7ff624bb531d706c365e6b85557e48c2697804e85b06",
    "transactionIndex": 0,
    "blockHash": "0xbf55f5179281606b9cba225798e13dd03c4fe11a96854f8df5e55db81b461b0a",
    "blockNumber": 70,
    "gasUsed": 287752,
    "contractAddress": "0x93a17e78d08e1a0d98269b3bf5656eaed2c2416c",
    "root": "0x561780e011513bc409a1beb332f3719e4ac6f8cae790a932aa271a5a079d211e",
    "status": "0x0",
    "message": null,
    "from": "0xdb4ed7a548623c219235aa68156f117dff959a17",
    "to": "0x0000000000000000000000000000000000000000",
    "input": "0x608060405234801561001057600080fd5b50610373806100206000396000f30060806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063299f7f9d146100515780633590b49f146100e1575b600080fd5b34801561005d57600080fd5b5061006661014a565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100a657808201518184015260208101905061008b565b50505050905090810190601f1680156100d35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156100ed57600080fd5b50610148600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506101ec565b005b606060008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101e25780601f106101b7576101008083540402835291602001916101e2565b820191906000526020600020905b8154815290600101906020018083116101c557829003601f168201915b5050505050905090565b7f05432a43e07f36a8b98100b9cb3631e02f8e796b0a06813610ce8942e972fb81816040518080602001828103825283818151815260200191508051906020019080838360005b8381101561024e578082015181840152602081019050610233565b50505050905090810190601f16801561027b5780820380516001836020036101000a031916815260200191505b509250505060405180910390a1806000908051906020019061029e9291906102a2565b5050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106102e357805160ff1916838001178555610311565b82800160010185558215610311579182015b828111156103105782518255916020019190600101906102f5565b5b50905061031e9190610322565b5090565b61034491905b80821115610340576000816000905550600101610328565b5090565b905600a165627a7a7230582077e2db38eecb729562ac614505b3507007a6acce30fd30971bd0501a019eb02d0029",
    "output": "0x",
    "logs": [],
    "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
  }
}
```

b.异常返回结果示例（信息详情请参看附录1）
```
{
  "code": 103001,
  "message": "system error",
  "data": null
}
```

## 2. 交易接口

### 2.1 交易请求接口 

#### 接口描述

调用此接口发送交易请求，数据上链或查询结果。

#### 接口URL

http://localhost:5003/WeBASE-Transaction/trans/send

#### 调用方法

HTTP POST

#### 请求参数

**1）参数表**

| **序号** | **中文**     | **参数名**      | **类型**       | **最大长度** | **必填** | **说明**                        |
| -------- | ------------ | --------------- | -------------- | ------------ | -------- | ------------------------------- |
| 1        | 群组编号     | groupId         | int            | 16           | 是       |                                 |
| 2        | 合约地址     | contractAddress | String         |              | 是       |                                 |
| 3        | 方法Abi      | functionAbi     | List\<Object\> |              | 是       | JSON数组，所调用方法的abi       |
| 4        | 调用方法名   | funcName        | String         |              | 是       |                                 |
| 5        | 方法参数     | funcParam       | List\<Object\> |              | 否       | JSON数组                        |
| 6        | 签名用户编号 | signUserId      | int            |              | 否       | WeBASE-Sign用户，数据上链时必填 |

**2）数据格式**

```
{
  "contractAddress": "0x93a17e78d08e1a0d98269b3bf5656eaed2c2416c",
  "funcName": "set",
  "funcParam": ["hello"],
  "functionAbi": [{"constant":false,"inputs":[{"name":"n","type":"string"}],"name":"set","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}],
  "groupId": 1,
  "signUserId": "user1001"
}
```

#### 响应参数

**1）参数表**

| **序号** | **中文** | **参数名** | **类型** | **最大长度** | **必填** | **说明**          |
| -------- | -------- | ---------- | -------- | ------------ | -------- | ----------------- |
| 1        | 返回码   | code       | String   |              | 是       | 返回码信息请附录1 |
| 2        | 提示信息 | message    | String   |              | 是       |                   |
| 3        | 返回数据 | data       | Object   |              |          |                   |

**2）数据格式**

a.交易上链正常返回结果

```
{
  "code": 0,
  "message": "success",
  "data": {
    "transactionHash": "0x86f82c64cb3149c0e28a0f4375379e56a4ac632e7940ee91551cc5ca703c6122",
    "transactionIndex": 0,
    "blockHash": "0x5e76e956275bf2db3109c1fd0249cfc52f8603616643db07f8a61d6ac8dfdc24",
    "blockNumber": 71,
    "gasUsed": 44956,
    "contractAddress": "0x0000000000000000000000000000000000000000",
    "root": "0x0de73d3fc1fb489bf83d92114455f5cfd59ec5e3a5362575401d3b9254bfc15f",
    "status": "0x0",
    "message": null,
    "from": "0xdb4ed7a548623c219235aa68156f117dff959a17",
    "to": "0x93a17e78d08e1a0d98269b3bf5656eaed2c2416c",
    "input": "0x3590b49f0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000568656c6c6f000000000000000000000000000000000000000000000000000000",
    "output": "0x",
    "logs": [
      {
        "logIndex": null,
        "transactionIndex": null,
        "transactionHash": null,
        "blockHash": null,
        "blockNumber": null,
        "address": "0x93a17e78d08e1a0d98269b3bf5656eaed2c2416c",
        "data": "0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000568656c6c6f000000000000000000000000000000000000000000000000000000",
        "topics": [
          "0x05432a43e07f36a8b98100b9cb3631e02f8e796b0a06813610ce8942e972fb81"
        ]
      }
    ],
    "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000040000000000200000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000"
  }
}
```

b.交易查询正常返回结果

```
{
  "code": 0,
  "message": "success",
  "data": [
    "hello"
  ]
}
```

c.异常返回结果示例（信息详情请参看附录1）

```
{
  "code": 103001,
  "message": "system error",
  "data": null
}
```

### 2.2 根据交易hash获取交易信息

#### 接口描述

根据交易hash获取交易信息。

#### 接口URL

http://localhost:5003/WeBASE-Transaction/trans/getTransactionByHash/{groupId}/{transHash}

#### 调用方法

HTTP GET

#### 请求参数

**1）参数表**

| **序号** | **中文** | **参数名** | **类型** | **最大长度** | **必填** | **说明** |
| -------- | -------- | ---------- | -------- | ------------ | -------- | -------- |
| 1        | 群组编号 | groupId    | int      | 16           | 是       |          |
| 2        | 交易hash | transHash  | String   |              | 是       |          |

**2）数据格式**

```
http://localhost:5003/WeBASE-Transaction/trans/getTransactionByHash/1/0x389efacb98156ce5eceab2caed61523f6c88d97a842dd95f9a5abe9e2a90d3fa
```

#### 响应参数

**1）参数表**

| **序号** | **中文** | **参数名** | **类型** | **最大长度** | **必填** | **说明**          |
| -------- | -------- | ---------- | -------- | ------------ | -------- | ----------------- |
| 1        | 返回码   | code       | String   |              | 是       | 返回码信息请附录1 |
| 2        | 提示信息 | message    | String   |              | 是       |                   |
| 3        | 返回数据 | data       | Object   |              |          |                   |

**2）数据格式**

a.正常返回结果

```
{
  "code": 0,
  "message": "success",
  "data": {
    "hash": "0x389efacb98156ce5eceab2caed61523f6c88d97a842dd95f9a5abe9e2a90d3fa",
    "nonce": 6.107833841210527e+74,
    "blockHash": "0xcfb90dd20ebc048c03f27120db0c389542b91d62cd8318ec181c0353ffd5b5e7",
    "blockNumber": 73,
    "transactionIndex": 0,
    "from": "0xdb4ed7a548623c219235aa68156f117dff959a17",
    "to": "0x93a17e78d08e1a0d98269b3bf5656eaed2c2416c",
    "value": 0,
    "gasPrice": 100000000,
    "gas": 100000000,
    "input": "0x3590b49f0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000568656c6c6f000000000000000000000000000000000000000000000000000000",
    "creates": null,
    "publicKey": null,
    "raw": null,
    "r": null,
    "s": null,
    "v": 0,
    "valueRaw": "0x0",
    "gasRaw": "0x5f5e100",
    "gasPriceRaw": "0x5f5e100",
    "nonceRaw": "0x159b0eed9e7e81d593c68a501299f76df36b37bf05e5400303aeb217239ecc3",
    "blockNumberRaw": "0x49",
    "transactionIndexRaw": "0x0"
  }
}
```

b.异常返回结果示例（信息详情请参看附录1）

```
{
  "code": 103001,
  "message": "system error",
  "data": null
}
```

### 2.3 根据交易hash获取交易回执信息

#### 接口描述

根据交易hash获取交易回执信息。

#### 接口URL

http://localhost:5003/WeBASE-Transaction/trans/getTransactionReceipt/{groupId}/{transHash}

#### 调用方法

HTTP GET

#### 请求参数

**1）参数表**

| **序号** | **中文** | **参数名** | **类型** | **最大长度** | **必填** | **说明** |
| -------- | -------- | ---------- | -------- | ------------ | -------- | -------- |
| 1        | 群组编号 | groupId    | int      | 16           | 是       |          |
| 2        | 交易hash | transHash  | String   |              | 是       |          |

**2）数据格式**

```
http://localhost:5003/WeBASE-Transaction/trans/getTransactionReceipt/1/0x389efacb98156ce5eceab2caed61523f6c88d97a842dd95f9a5abe9e2a90d3fa
```

#### 响应参数

**1）参数表**

| **序号** | **中文** | **参数名** | **类型** | **最大长度** | **必填** | **说明**          |
| -------- | -------- | ---------- | -------- | ------------ | -------- | ----------------- |
| 1        | 返回码   | code       | String   |              | 是       | 返回码信息请附录1 |
| 2        | 提示信息 | message    | String   |              | 是       |                   |
| 3        | 返回数据 | data       | Object   |              |          |                   |

**2）数据格式**

a.正常返回结果

```
{
  "code": 0,
  "message": "success",
  "data": {
    "transactionHash": "0x389efacb98156ce5eceab2caed61523f6c88d97a842dd95f9a5abe9e2a90d3fa",
    "transactionIndex": 0,
    "blockHash": "0xcfb90dd20ebc048c03f27120db0c389542b91d62cd8318ec181c0353ffd5b5e7",
    "blockNumber": 73,
    "gasUsed": 35013,
    "contractAddress": "0x0000000000000000000000000000000000000000",
    "root": "0xf0b50585258d92d1704c91182932e51dc7b02c8c7ffa99c8b9768facf29e3793",
    "status": "0x0",
    "message": null,
    "from": "0xdb4ed7a548623c219235aa68156f117dff959a17",
    "to": "0x93a17e78d08e1a0d98269b3bf5656eaed2c2416c",
    "input": "0x3590b49f0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000568656c6c6f000000000000000000000000000000000000000000000000000000",
    "output": "0x",
    "logs": [
      {
        "logIndex": null,
        "transactionIndex": null,
        "transactionHash": null,
        "blockHash": null,
        "blockNumber": null,
        "address": "0x93a17e78d08e1a0d98269b3bf5656eaed2c2416c",
        "data": "0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000568656c6c6f000000000000000000000000000000000000000000000000000000",
        "topics": [
          "0x05432a43e07f36a8b98100b9cb3631e02f8e796b0a06813610ce8942e972fb81"
        ]
      }
    ],
    "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000040000000000200000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000"
  }
}
```

b.异常返回结果示例（信息详情请参看附录1）

```
{
  "code": 103001,
  "message": "system error",
  "data": null
}
```

## 3. 其他接口

### 3.1 获取节点加密类型接口 

#### 接口描述

返回所连节点使用的加密类型`encryptType`，0：标准，1：国密。

#### 接口URL

http://localhost:5003/WeBASE-Transaction/encrypt

#### 调用方法

HTTP GET

#### 请求参数

**1）参数表**

| **序号** | **中文**   | **参数名** | **类型** | **最大长度** | **必填** | **说明** |
|----------|------------|------------|----------|--------------|----------|----------|
| 1        | -          | -         | -       | -           | -       |          |

**2）数据格式**

```
http://127.0.0.1:5003/WeBASE-Transaction/encrypt
```

#### 响应参数

**1）参数表**

| **序号** | **中文** | **参数名** | **类型** | **最大长度** | **必填** | **说明**          |
|----------|----------|------------|----------|--------------|----------|-------------------|
| 1        | 返回码   | code       | String   |              | 是       | 返回码信息请附录1 |
| 2        | 提示信息 | message    | String   |              | 是       |                   |
| 3        | 返回数据 | data       | Integer   |              | 是 |  encryptType: 0:标准, 1:国密  |

**2）数据格式**

a.请求正常返回结果
```
{
  "code": 0,
  "message": "success",
  "data": 0
}
```

## 附录 

### 1. 返回码信息列表

| Code   | message                                  | 描述                     |
| ------ | ---------------------------------------- | ------------------------ |
| 0      | success                                  | 正常                     |
| 103001 | system error                             | 系统异常                 |
| 103002 | param valid fail                         | 参数校验异常             |
| 203001 | contract funcParam is error              | 合约方法参数错误         |
| 203002 | request group id has not been configured | 请求的群组未配置         |
| 203003 | signUserId check failed                  | 签名用户编号校验失败     |
| 203004 | function is not exists                   | 方法名不存在             |
| 203005 | web3jMap is empty                        | web3jMap为空，初始化异常 |
| 203006 | web3j is null, please check groupId      | web3j为空，检查群组编号  |
| 203007 | data request sign error                  | 数据请求签名异常         |
| 203008 | node request failed                      | 节点请求失败             |